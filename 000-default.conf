<VirtualHost *:80>
    # Información del servidor
    ServerAdmin admin@corporacionorganica.com
    
    # La raíz del documento debe apuntar a la carpeta 'public' de Laravel
    DocumentRoot /var/www/html/public

    # Configuración del directorio público de Laravel
    <Directory /var/www/html/public>
        # Permite usar el archivo .htaccess de Laravel (reescritura de URLs)
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # Forzar HTTPS en producción (si está detrás de un proxy como Render)
        # Descomenta las siguientes líneas si tienes problemas con redirecciones HTTPS
        # SetEnvIf X-Forwarded-Proto https HTTPS=on
        
        # Prevenir acceso directo a archivos sensibles
        <FilesMatch "^\.">
            Require all denied
        </FilesMatch>
    </Directory>

    # Desactivar acceso a directorios fuera de public
    <Directory /var/www/html>
        Options -Indexes
        AllowOverride None
        Require all denied
    </Directory>

    # Proteger archivos de configuración
    <FilesMatch "^\.env">
        Require all denied
    </FilesMatch>

    # Compresión GZIP para mejor rendimiento
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
    </IfModule>

    # Cache para archivos estáticos
    <IfModule mod_expires.c>
        ExpiresActive On
        
        # Imágenes
        ExpiresByType image/jpeg "access plus 1 year"
        ExpiresByType image/png "access plus 1 year"
        ExpiresByType image/gif "access plus 1 year"
        ExpiresByType image/svg+xml "access plus 1 year"
        ExpiresByType image/webp "access plus 1 year"
        
        # CSS y JavaScript
        ExpiresByType text/css "access plus 1 month"
        ExpiresByType application/javascript "access plus 1 month"
        
        # Fuentes
        ExpiresByType font/woff2 "access plus 1 year"
        ExpiresByType font/woff "access plus 1 year"
        ExpiresByType font/ttf "access plus 1 year"
    </IfModule>

    # Headers de seguridad
    <IfModule mod_headers.c>
        # Prevenir clickjacking
        Header always set X-Frame-Options "SAMEORIGIN"
        
        # Prevenir MIME sniffing
        Header always set X-Content-Type-Options "nosniff"
        
        # Habilitar XSS protection
        Header always set X-XSS-Protection "1; mode=block"
        
        # Política de referrer
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
    </IfModule>

    # Configuración de logs
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    
    # Log level (cambiar a 'warn' en producción para menos logs)
    LogLevel warn
</VirtualHost>

# Configuración adicional para SSL (si se usa)
# <VirtualHost *:443>
#     ServerName tu-dominio.com
#     DocumentRoot /var/www/html/public
#     
#     SSLEngine on
#     SSLCertificateFile /path/to/cert.pem
#     SSLCertificateKeyFile /path/to/key.pem
#     
#     # Incluir la misma configuración de arriba
# </VirtualHost>